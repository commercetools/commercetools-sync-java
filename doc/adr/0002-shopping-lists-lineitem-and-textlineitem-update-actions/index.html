
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Java Library used to import and/or sync (taking care of changes) data into one or more commercetools projects from external sources such as CSV, XML, JSON, etc.. or even from an already existing commercetools project.">
      
      
        <meta name="author" content="commercetools">
      
      
        <link rel="canonical" href="https://commercetools.github.io/commercetools-sync-java/doc/adr/0002-shopping-lists-lineitem-and-textlineitem-update-actions/">
      
      <link rel="icon" href="../../images/ct.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>2. LineItem and TextLineItem update actions of the ShoppingLists. - commercetools-sync-java</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-lineitem-and-textlineitem-update-actions-of-the-shoppinglists" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="commercetools-sync-java" class="md-header__button md-logo" aria-label="commercetools-sync-java" data-md-component="logo">
      
  <img src="../../images/ct.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            commercetools-sync-java
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2. LineItem and TextLineItem update actions of the ShoppingLists.
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="http://github.com/commercetools/commercetools-sync-java" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    commercetools-sync-java
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="commercetools-sync-java" class="md-nav__button md-logo" aria-label="commercetools-sync-java" data-md-component="logo">
      
  <img src="../../images/ct.png" alt="logo">

    </a>
    commercetools-sync-java
  </label>
  
    <div class="md-nav__source">
      <a href="http://github.com/commercetools/commercetools-sync-java" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    commercetools-sync-java
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          User guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/QUICK_START/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/PRODUCT_SYNC/" class="md-nav__link">
        Product Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/PRODUCT_TYPE_SYNC/" class="md-nav__link">
        ProductType Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/TYPE_SYNC/" class="md-nav__link">
        Type Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/CATEGORY_SYNC/" class="md-nav__link">
        Category Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/INVENTORY_SYNC/" class="md-nav__link">
        InventoryEntry Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/CART_DISCOUNT_SYNC/" class="md-nav__link">
        CartDiscount Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/TAX_CATEGORY_SYNC/" class="md-nav__link">
        TaxCategory Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/STATE_SYNC/" class="md-nav__link">
        State Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/CUSTOM_OBJECT_SYNC/" class="md-nav__link">
        CustomObject Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/CUSTOMER_SYNC/" class="md-nav__link">
        Customer Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/SHOPPING_LIST_SYNC/" class="md-nav__link">
        ShoppingList Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_13" type="checkbox" id="__nav_2_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_13">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_13">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/SYNC_OPTIONS/" class="md-nav__link">
        Sync Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/IMPORTANT_USAGE_TIPS/" class="md-nav__link">
        Usage Tips
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/CLEANUP_GUIDE/" class="md-nav__link">
        Cleanup Unresolved References
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://commercetools.github.io/commercetools-sync-java/v/9.0.3/" class="md-nav__link">
        Javadoc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../RELEASE_NOTES/" class="md-nav__link">
        Release notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/commercetools/commercetools-sync-java/issues" class="md-nav__link">
        Issues
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://commercetools.github.io/commercetools-sync-java/benchmarks/" class="md-nav__link">
        Benchmarks
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lineitems" class="md-nav__link">
    LineItems
  </a>
  
    <nav class="md-nav" aria-label="LineItems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-ensure-line-item-order" class="md-nav__link">
    How to ensure line item order?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#do-we-need-to-remove-all-line-items-when-the-order-changes" class="md-nav__link">
    Do we need to remove all line items when the order changes ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#do-we-need-to-remove-and-add-all-line-items-when-no-new-line-item-is-added-or-removed-just-order-is-different" class="md-nav__link">
    Do we need to remove and add all line items when no new line item is added or removed, just order is different ?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#textlineitems" class="md-nav__link">
    TextLineItems
  </a>
  
    <nav class="md-nav" aria-label="TextLineItems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-ensure-text-line-item-order" class="md-nav__link">
    How to ensure text line item order?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common" class="md-nav__link">
    Common
  </a>
  
    <nav class="md-nav" aria-label="Common">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-addedat-will-be-compared" class="md-nav__link">
    How addedAt will be compared?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    Decision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    Consequences
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="http://github.com/commercetools/commercetools-sync-java/edit/master/docs/adr/0002-shopping-lists-lineitem-and-textlineitem-update-actions.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="2-lineitem-and-textlineitem-update-actions-of-the-shoppinglists">2. LineItem and TextLineItem update actions of the ShoppingLists.<a class="headerlink" href="#2-lineitem-and-textlineitem-update-actions-of-the-shoppinglists" title="Permanent link">&para;</a></h1>
<p>Date: 2020-11-04</p>
<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/commercetools/commercetools-sync-java/pull/614">Approved</a></p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<!-- The issue motivating this decision, and any context that influences or constrains the decision. -->

<p>In a commerce application, a shopping list is a personal wishlist of a customer, (i.e. ingredients for a recipe, birthday wishes). 
Shopping lists hold line items of products in the platform or any other items that can be described as text line items.</p>
<p>We have challenges to build update actions of the <code>LineItem</code> and <code>TextLineItem</code> because of the nature of the synchronization, 
so in this document, we will describe the reasons and constraints, mostly related to order of the items: 
- LineItem orders might be important, if the customer has a front end that sorts the line items with their order could mean sorting by importance.</p>
<h2 id="lineitems">LineItems<a class="headerlink" href="#lineitems" title="Permanent link">&para;</a></h2>
<h3 id="how-to-ensure-line-item-order">How to ensure line item order?<a class="headerlink" href="#how-to-ensure-line-item-order" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>LineItemDrafts</th>
        <th>LineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-2"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>Draft has line items with <b>SKU-1</b> and <b>SKU-2</b>. In the target project line item with
                <b>SKU-2</b> exists, so <b>SKU-1</b> is a new line item. </p>
            <p> So we need to create an <a href="https://docs.commercetools.com/api/projects/shoppingLists#add-lineitem">AddLineItem</a> action
                and a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change LineItems Order</a> 
                of the line items <b>SKU-1</b> and <b>SKU-2</b>, because when we add line item with <b>SKU-1</b>
                the order will be <b>SKU-2</b> and <b>SKU-1</b>.</p>
            <p>The <b>challenge</b> in here is, those actions can not be added in one request because we don't know the
                line item id of the new line item
                with <b>SKU-1</b>, so we need to find another way to create a new line item with the right order.</p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                Normally, for a difference, we might do a set intersection and then calculate action for differences, 
                but that does not make sense because we are not aware of the order from the draft. 
                So in this case the one request could be created but we might need to remove line item with <b>SKU-2</b>
                and line items in the draft with the given order with the line items <b>SKU-1</b> and <b>SKU-2</b>.
            </p>
            <pre lang="json">
{
  "version": 1,
  "actions": [
    {
      "action": "removeLineItem",
      "lineItemId": "24de3821-e27d-4ddb-bd0b-ecc99365285f"
    },
    {
      "action": "addLineItem",
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "action": "addLineItem",
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
    </tr>
</table>

<h3 id="do-we-need-to-remove-all-line-items-when-the-order-changes">Do we need to remove all line items when the order changes ?<a class="headerlink" href="#do-we-need-to-remove-all-line-items-when-the-order-changes" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>LineItemDrafts</th>
        <th>LineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "sku": "SKU-3",
      "quantity": 3,
      "addedAt": "2020-11-05T10:00:10.101Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-3"
        }
      }
    },
    {
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }        
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "id": "1c38d582-2e65-43f8-85db-4d34e6cff57a",
      "variant": {
        "sku": "SKU-1"
      },
      "quantity": 1,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-1"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    },
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-2"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:40:12.341Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>Draft has line items with <b>SKU-1</b>, <b>SKU-3</b> and <b>SKU-2</b> also in target project line item with
                <b>SKU-1</b> exists in the same order, <b>SKU-3</b> is a new line item, and <b>SKU-2</b> needs to be in last order.</p>
            <p> So we need to create an <a href="https://docs.commercetools.com/api/projects/shoppingLists#add-lineitem">AddLineItem</a> action and
                a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change LineItems Order</a>
                of the line items <b>SKU-2</b> and <b>SKU-3</b>, because when we add line item with <b>SKU-3</b>
                the order will be <b>SKU-1</b>, <b>SKU-2</b> and <b>SKU-3</b>.</p>
            <p>The <b>challenge</b> in here is, those actions can not be added in one request because we don't know the
                line item id of the new line item
                with <b>SKU-3</b>, so we need to find another way to create a new line item with the right order.</p>
            <p>Also another <b>challenge</b> in here is about the line item with <b>SKU-1</b>, as the order and data is
                exactly same, we need to find a better way to avoid creating unnecessary actions.
            </p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                The solution idea about the new line item and changed order is still same like in the case-1. Do we
                need to remove and add line item with <b>SKU-1</b>? No, it is not needed and we could start the removing
                and adding from the first order change.
            </p>
            <pre lang="json">
{
  "version": 1,
  "actions": [
    {
      "action": "removeLineItem",
      "lineItemId": "24de3821-e27d-4ddb-bd0b-ecc99365285f"
    },
    {
      "action": "addLineItem",
      "sku": "SKU-3",
      "quantity": 3,
      "addedAt": "2020-11-05T10:00:10.101Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-3"
        }
      }
    },
    {
      "action": "addLineItem",
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
    </tr>
</table>

<h3 id="do-we-need-to-remove-and-add-all-line-items-when-no-new-line-item-is-added-or-removed-just-order-is-different">Do we need to remove and add all line items when no new line item is added or removed, just order is different ?<a class="headerlink" href="#do-we-need-to-remove-and-add-all-line-items-when-no-new-line-item-is-added-or-removed-just-order-is-different" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>LineItemDrafts</th>
        <th>LineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-05T10:00:10.101Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    },
    {
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    }
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-1"
      },
      "quantity": 1,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-1"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    },
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-2"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:40:12.341Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>The Draft has line items with <b>SKU-2</b> and <b>SKU-1</b> also in target project line item
                with <b>SKU-2</b> and <b>SKU-1</b> exists but in a different order.</p>
            <p> So we need
                a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change
                    LineItems Order</a>
                of the line items with order <b>SKU-2</b> and <b>SKU-1</b>.</p>
            <p>The <b>challenge</b> here is about the line item order and no new line item is added or removed,
                just order is different, so we need to find a better way to avoid creating unnecessary actions like
                removing and adding back, is this possible ?
            </p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                The solution idea for the changing order with removing and adding back looks like an overhead. We know 
                all line item ids, so change order action could be created. However, the challenge is
                finding an algorithm to compare and find the line item ids, and then prepare an order.                
            </p>
            <p>
                The example above seems reasonable but how you would sync a case like: 
                <b>[SKU-1, SKU-2, SKU-3]</b> to <b>[SKU-3, SKU-1, SKU-4, SKU-2]</b>, so with a different algorithm it might 
                be done with change order <b>[line-item-id-3, line-item-id-1, line-item-id-2]</b> then <b>removeLineItem 
                SKU-2</b>, add back <b>addLineItem SKU-4</b>, in total 3 actions. Even for this we need to remove and add back.
            </p>
            <p>
                It looks like there are more different cases, when we dig in. <b>That's why we decided to keep the idea 
                of removing and adding back to  not have a more complex algorithm.</b>      
            </p>
        </td>
    </tr>
</table>

<h2 id="textlineitems">TextLineItems<a class="headerlink" href="#textlineitems" title="Permanent link">&para;</a></h2>
<h3 id="how-to-ensure-text-line-item-order">How to ensure text line item order?<a class="headerlink" href="#how-to-ensure-text-line-item-order" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>TextLineItemDrafts</th>
        <th>TextLineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "textLineItems": [
    {
     "name": {
        "de": "name1-DE",
        "en": "name1-EN"
      },
      "description": {
        "de": "desc1-DE",
        "en": "desc1-EN"
      },
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "name": {
        "de": "name2-DE",
        "en": "name2-EN"
      },
      "description": {
        "de": "desc2-DE",
        "en": "desc2-EN"
      },
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "textLineItems": [
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "name": {
        "de": "name2-DE",
        "en": "name2-EN"
      },
      "description": {
        "de": "desc2-DE",
        "en": "desc2-EN"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>Draft has text line items with <b>name-1</b> and <b>name-2</b>. In the target project text line item with
                <b>name-2</b> exists, so <b>name-1</b> is a new text line item. </p>
            <p> So we need to create an <a
                    href="https://docs.commercetools.com/api/projects/shoppingLists#add-textlineitem">AddTextLineItem</a>
                action
                and a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-textlineitems-order">Change
                    TextLineItems Order</a>
                of the text line items <b>name-1</b> and <b>name-2</b>, because when we add text line item with <b>name-1</b>
                the order will be <b>name-2</b> and <b>name-1</b>.</p>
            <p>The <b>challenge</b> in here is, those actions cannot be added in one request because we don't know the
                text line item id of the new text line item
                with <b>name-1</b>. We need to find another way to create a new text line item with the right order.
            </p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                Normally, for a difference, we do a set intersection and then calculate action for differences,
                but that does not make sense because we are not aware of the order from the draft.
            </p>
            <p>
                Before that, we need to analyse the <a
                    href="https://docs.commercetools.com/api/projects/shoppingLists#add-textlineitem">AddTextLineItem</a>
                action, because the platform is not checking if the data exist. An API user could add the
                exact same data multiple times. So it's impossible to know the order by
                just checking the differences between the resource and draft object. Also, the name of the text line item 
                does not need to be unique as line item does. Each line item is identified by its product variant and 
                custom fields. Luckily the platform supports changing all field (except <b>addedAt</b>) of the text line 
                items, so when an order change is needed we update the
                fields of the text line items. Which will look like:
            </p>
            <pre lang="json">
{
  "version": 1,
  "actions": [
    {
      "action" : "changeTextLineItemName",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "name": {
        "de": "name1-DE",
        "en": "name1-EN"
      }
    },
    {
      "action" : "changeTextLineItemQuantity",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "quantity" : 1
    },
    {
      "action" : "setTextLineItemDescription",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "description": {
        "de": "desc1-DE",
        "en": "desc1-EN"
      }
    },
    {
      "action" : "setTextLineItemCustomField",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "name" : "textField",
      "value" : "text-1"
    },
    {
      "action" : "addTextLineItem",
      "name": {
        "de": "name2-DE",
        "en": "name2-EN"
      },
      "description": {
        "de": "desc2-DE",
        "en": "desc2-EN"
      },
      "quantity": 2,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
    </tr>
</table>

<h2 id="common">Common<a class="headerlink" href="#common" title="Permanent link">&para;</a></h2>
<h3 id="how-addedat-will-be-compared">How addedAt will be compared?<a class="headerlink" href="#how-addedat-will-be-compared" title="Permanent link">&para;</a></h3>
<p>In commercetools shopping lists API, there is no <a href="https://docs.commercetools.com/api/projects/shoppingLists#update-actions">update action</a> 
to change the <code>addedAt</code> field of the <code>LineItem</code> and <code>TextLineItem</code>, also in API it has a default value described as <code>Defaults to the current date and time.</code>, 
when it's not set in the draft, so how to compare and update this field?</p>
<p><strong>Proposed solution:</strong></p>
<p>The <code>addedAt</code> field will be synced only if the value provided in the line item draft, otherwise, the <code>addedAt</code> value will be omitted. 
To be able to sync it we need to remove and add this line item back with the up-to-date value. 
After some discussions in pull requests, we decided to not change this field.</p>
<h2 id="decision">Decision<a class="headerlink" href="#decision" title="Permanent link">&para;</a></h2>
<!-- The change that we're proposing or have agreed to implement. -->

<ul>
<li>
<p>In commercetools API, the product variant to be selected in the LineItemDraft can be specified either by its product ID plus variant ID or by its SKU. 
For the sync library, product variant will be matched by its SKU, if the SKU not set for a LineItemDraft, the draft will not be synced and an error callback will be triggered.
Check <a href="https://docs.commercetools.com/api/projects/shoppingLists#lineitemdraft-product-variant-selection">LineItemDraft Product Variant Selection</a> for more details.</p>
</li>
<li>
<p>When a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change LineItems Order</a> action is needed, 
the line items will be removed and added back with the order provided in the <code>ShoppingListDraft</code>.</p>
</li>
<li>
<p>When a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-textlineitems-order">Change TextLineItems Order</a> action is needed, 
the text line items will be updated with using update actions with the order provided in the <code>ShoppingListDraft</code>.</p>
</li>
<li>
<p>In commercetools shopping lists API, there is no <a href="https://docs.commercetools.com/api/projects/shoppingLists#update-actions">update action</a> 
to change the <code>addedAt</code> field of the <code>LineItem</code> and <code>TextLineItem</code>, hereby we will not update the <code>addedAt</code> value.</p>
</li>
</ul>
<h2 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h2>
<!-- What becomes easier or more difficult to do and any risks introduced by the change that will need to be mitigated. -->

<ul>
<li>
<p>To ensure the order of the line items, we need to remove and add line items. That means a bigger payload and a performance overhead. </p>
</li>
<li>
<p>To ensure the order of text line items, we need to calculate and update more than expected. That means a bigger payload and a performance overhead.</p>
</li>
<li>
<p><strong>Caveat</strong>: <code>addedAt</code> values not synced.</p>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 commercetools
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>