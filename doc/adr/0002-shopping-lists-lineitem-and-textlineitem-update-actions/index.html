



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Java Library used to import and/or sync (taking care of changes) data into one or more commercetools projects from external sources such as CSV, XML, JSON, etc.. or even from an already existing commercetools project.">
      
      
        <link rel="canonical" href="https://commercetools.github.io/commercetools-sync-java/doc/adr/0002-shopping-lists-lineitem-and-textlineitem-update-actions/">
      
      
        <meta name="author" content="commercetools">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/ct.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>2. LineItem and TextLineItem update actions of the ShoppingLists. - commercetools-sync-java</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#2-lineitem-and-textlineitem-update-actions-of-the-shoppinglists" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://commercetools.github.io/commercetools-sync-java/doc" title="commercetools-sync-java" aria-label="commercetools-sync-java" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../images/ct.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              commercetools-sync-java
            </span>
            <span class="md-header-nav__topic">
              
                2. LineItem and TextLineItem update actions of the ShoppingLists.
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="http://github.com/commercetools/commercetools-sync-java/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    commercetools-sync-java
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://commercetools.github.io/commercetools-sync-java/doc" title="commercetools-sync-java" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../images/ct.png" width="48" height="48">
      
    </a>
    commercetools-sync-java
  </label>
  
    <div class="md-nav__source">
      


  

<a href="http://github.com/commercetools/commercetools-sync-java/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    commercetools-sync-java
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      User guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/QUICK_START/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/PRODUCT_SYNC/" title="Product Sync" class="md-nav__link">
      Product Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/PRODUCT_TYPE_SYNC/" title="ProductType Sync" class="md-nav__link">
      ProductType Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/TYPE_SYNC/" title="Type Sync" class="md-nav__link">
      Type Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/CATEGORY_SYNC/" title="Category Sync" class="md-nav__link">
      Category Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/INVENTORY_SYNC/" title="InventoryEntry Sync" class="md-nav__link">
      InventoryEntry Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/CART_DISCOUNT_SYNC/" title="CartDiscount Sync" class="md-nav__link">
      CartDiscount Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/TAX_CATEGORY_SYNC/" title="TaxCategory Sync" class="md-nav__link">
      TaxCategory Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/STATE_SYNC/" title="State Sync" class="md-nav__link">
      State Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/CUSTOM_OBJECT_SYNC/" title="CustomObject Sync" class="md-nav__link">
      CustomObject Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/CUSTOMER_SYNC/" title="Customer Sync" class="md-nav__link">
      Customer Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/SHOPPING_LIST_SYNC/" title="ShoppingList Sync" class="md-nav__link">
      ShoppingList Sync
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-13" type="checkbox" id="nav-2-13">
    
    <label class="md-nav__link" for="nav-2-13">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-13">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/SYNC_OPTIONS/" title="Sync Options" class="md-nav__link">
      Sync Options
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/IMPORTANT_USAGE_TIPS/" title="Usage Tips" class="md-nav__link">
      Usage Tips
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://commercetools.github.io/commercetools-sync-java/v/3.0.2/" title="Javadoc" class="md-nav__link">
      Javadoc
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../RELEASE_NOTES/" title="Release notes" class="md-nav__link">
      Release notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/commercetools/commercetools-sync-java/milestones" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/commercetools/commercetools-sync-java/issues" title="Issues" class="md-nav__link">
      Issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://commercetools.github.io/commercetools-sync-java/benchmarks/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lineitems" class="md-nav__link">
    LineItems
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-ensure-line-item-order" class="md-nav__link">
    How to ensure line item order?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#do-we-need-to-remove-all-line-items-when-the-order-changes" class="md-nav__link">
    Do we need to remove all line items when the order changes ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#do-we-need-to-remove-and-add-all-line-items-when-no-new-line-item-is-added-or-removed-just-order-is-different" class="md-nav__link">
    Do we need to remove and add all line items when no new line item is added or removed, just order is different ?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#textlineitems" class="md-nav__link">
    TextLineItems
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-ensure-text-line-item-order" class="md-nav__link">
    How to ensure text line item order?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common" class="md-nav__link">
    Common
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-addedat-will-be-compared" class="md-nav__link">
    How addedAt will be compared?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    Decision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    Consequences
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="http://github.com/commercetools/commercetools-sync-java/edit/master/docs/adr/0002-shopping-lists-lineitem-and-textlineitem-update-actions.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="2-lineitem-and-textlineitem-update-actions-of-the-shoppinglists">2. LineItem and TextLineItem update actions of the ShoppingLists.<a class="headerlink" href="#2-lineitem-and-textlineitem-update-actions-of-the-shoppinglists" title="Permanent link">&para;</a></h1>
<p>Date: 2020-11-04</p>
<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/commercetools/commercetools-sync-java/pull/614">Approved</a></p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<!-- The issue motivating this decision, and any context that influences or constrains the decision. -->

<p>In a commerce application, a shopping list is a personal wishlist of a customer, (i.e. ingredients for a recipe, birthday wishes). 
Shopping lists hold line items of products in the platform or any other items that can be described as text line items.</p>
<p>We have challenges to build update actions of the <code>LineItem</code> and <code>TextLineItem</code> because of the nature of the synchronization, 
so in this document, we will describe the reasons and constraints, mostly related to order of the items: 
- LineItem orders might be important, if the customer has a front end that sorts the line items with their order could mean sorting by importance.</p>
<h2 id="lineitems">LineItems<a class="headerlink" href="#lineitems" title="Permanent link">&para;</a></h2>
<h3 id="how-to-ensure-line-item-order">How to ensure line item order?<a class="headerlink" href="#how-to-ensure-line-item-order" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>LineItemDrafts</th>
        <th>LineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-2"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>Draft has line items with <b>SKU-1</b> and <b>SKU-2</b>. In the target project line item with
                <b>SKU-2</b> exists, so <b>SKU-1</b> is a new line item. </p>
            <p> So we need to create an <a href="https://docs.commercetools.com/api/projects/shoppingLists#add-lineitem">AddLineItem</a> action
                and a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change LineItems Order</a> 
                of the line items <b>SKU-1</b> and <b>SKU-2</b>, because when we add line item with <b>SKU-1</b>
                the order will be <b>SKU-2</b> and <b>SKU-1</b>.</p>
            <p>The <b>challenge</b> in here is, those actions can not be added in one request because we don't know the
                line item id of the new line item
                with <b>SKU-1</b>, so we need to find another way to create a new line item with the right order.</p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                Normally, for a difference, we might do a set intersection and then calculate action for differences, 
                but that does not make sense because we are not aware of the order from the draft. 
                So in this case the one request could be created but we might need to remove line item with <b>SKU-2</b>
                and line items in the draft with the given order with the line items <b>SKU-1</b> and <b>SKU-2</b>.
            </p>
            <pre lang="json">
{
  "version": 1,
  "actions": [
    {
      "action": "removeLineItem",
      "lineItemId": "24de3821-e27d-4ddb-bd0b-ecc99365285f"
    },
    {
      "action": "addLineItem",
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "action": "addLineItem",
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
    </tr>
</table>

<h3 id="do-we-need-to-remove-all-line-items-when-the-order-changes">Do we need to remove all line items when the order changes ?<a class="headerlink" href="#do-we-need-to-remove-all-line-items-when-the-order-changes" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>LineItemDrafts</th>
        <th>LineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "sku": "SKU-3",
      "quantity": 3,
      "addedAt": "2020-11-05T10:00:10.101Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-3"
        }
      }
    },
    {
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }        
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "id": "1c38d582-2e65-43f8-85db-4d34e6cff57a",
      "variant": {
        "sku": "SKU-1"
      },
      "quantity": 1,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-1"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    },
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-2"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:40:12.341Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>Draft has line items with <b>SKU-1</b>, <b>SKU-3</b> and <b>SKU-2</b> also in target project line item with
                <b>SKU-1</b> exists in the same order, <b>SKU-3</b> is a new line item, and <b>SKU-2</b> needs to be in last order.</p>
            <p> So we need to create an <a href="https://docs.commercetools.com/api/projects/shoppingLists#add-lineitem">AddLineItem</a> action and
                a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change LineItems Order</a>
                of the line items <b>SKU-2</b> and <b>SKU-3</b>, because when we add line item with <b>SKU-3</b>
                the order will be <b>SKU-1</b>, <b>SKU-2</b> and <b>SKU-3</b>.</p>
            <p>The <b>challenge</b> in here is, those actions can not be added in one request because we don't know the
                line item id of the new line item
                with <b>SKU-3</b>, so we need to find another way to create a new line item with the right order.</p>
            <p>Also another <b>challenge</b> in here is about the line item with <b>SKU-1</b>, as the order and data is
                exactly same, we need to find a better way to avoid creating unnecessary actions.
            </p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                The solution idea about the new line item and changed order is still same like in the case-1. Do we
                need to remove and add line item with <b>SKU-1</b>? No, it is not needed and we could start the removing
                and adding from the first order change.
            </p>
            <pre lang="json">
{
  "version": 1,
  "actions": [
    {
      "action": "removeLineItem",
      "lineItemId": "24de3821-e27d-4ddb-bd0b-ecc99365285f"
    },
    {
      "action": "addLineItem",
      "sku": "SKU-3",
      "quantity": 3,
      "addedAt": "2020-11-05T10:00:10.101Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-3"
        }
      }
    },
    {
      "action": "addLineItem",
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
    </tr>
</table>

<h3 id="do-we-need-to-remove-and-add-all-line-items-when-no-new-line-item-is-added-or-removed-just-order-is-different">Do we need to remove and add all line items when no new line item is added or removed, just order is different ?<a class="headerlink" href="#do-we-need-to-remove-and-add-all-line-items-when-no-new-line-item-is-added-or-removed-just-order-is-different" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>LineItemDrafts</th>
        <th>LineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "sku": "SKU-2",
      "quantity": 2,
      "addedAt": "2020-11-05T10:00:10.101Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    },
    {
      "sku": "SKU-1",
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    }
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "lineItems": [
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-1"
      },
      "quantity": 1,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-1"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    },
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "variant": {
        "sku": "SKU-2"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:40:12.341Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>The Draft has line items with <b>SKU-2</b> and <b>SKU-1</b> also in target project line item
                with <b>SKU-2</b> and <b>SKU-1</b> exists but in a different order.</p>
            <p> So we need
                a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change
                    LineItems Order</a>
                of the line items with order <b>SKU-2</b> and <b>SKU-1</b>.</p>
            <p>The <b>challenge</b> here is about the line item order and no new line item is added or removed,
                just order is different, so we need to find a better way to avoid creating unnecessary actions like
                removing and adding back, is this possible ?
            </p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                The solution idea for the changing order with removing and adding back looks like an overhead. We know 
                all line item ids, so change order action could be created. However, the challenge is
                finding an algorithm to compare and find the line item ids, and then prepare an order.                
            </p>
            <p>
                The example above seems reasonable but how you would sync a case like: 
                <b>[SKU-1, SKU-2, SKU-3]</b> to <b>[SKU-3, SKU-1, SKU-4, SKU-2]</b>, so with a different algorithm it might 
                be done with change order <b>[line-item-id-3, line-item-id-1, line-item-id-2]</b> then <b>removeLineItem 
                SKU-2</b>, add back <b>addLineItem SKU-4</b>, in total 3 actions. Even for this we need to remove and add back.
            </p>
            <p>
                It looks like there are more different cases, when we dig in. <b>That's why we decided to keep the idea 
                of removing and adding back to  not have a more complex algorithm.</b>      
            </p>
        </td>
    </tr>
</table>

<h2 id="textlineitems">TextLineItems<a class="headerlink" href="#textlineitems" title="Permanent link">&para;</a></h2>
<h3 id="how-to-ensure-text-line-item-order">How to ensure text line item order?<a class="headerlink" href="#how-to-ensure-text-line-item-order" title="Permanent link">&para;</a></h3>
<table>
    <tr>
        <th>TextLineItemDrafts</th>
        <th>TextLineItems</th>
    </tr>
    <tr>
        <td><pre lang="json">
{
  "textLineItems": [
    {
     "name": {
        "de": "name1-DE",
        "en": "name1-EN"
      },
      "description": {
        "de": "desc1-DE",
        "en": "desc1-EN"
      },
      "quantity": 1,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-1"
        }
      }
    },
    {
      "name": {
        "de": "name2-DE",
        "en": "name2-EN"
      },
      "description": {
        "de": "desc2-DE",
        "en": "desc2-EN"
      },
      "quantity": 2,
      "addedAt": "2020-11-04T09:40:12.341Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
        <td><pre lang="json">
{
  "textLineItems": [
    {
      "id": "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "name": {
        "de": "name2-DE",
        "en": "name2-EN"
      },
      "description": {
        "de": "desc2-DE",
        "en": "desc2-EN"
      },
      "quantity": 2,
      "custom": {
        "type": {
          "id": "4796e155-f5a4-403a-ae1a-04b10c9dfc54",
          "obj": {
            "key": "custom-type-for-shoppinglists"
          }
        },
        "fields": {
          "textField": "text-2"
        }
      },
     "addedAt": "2020-11-04T09:38:35.571Z"
    }
  ]
}
</pre>
        </td>
    </tr>
    <tr>
        <th colspan="2">Analysis</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>Draft has text line items with <b>name-1</b> and <b>name-2</b>. In the target project text line item with
                <b>name-2</b> exists, so <b>name-1</b> is a new text line item. </p>
            <p> So we need to create an <a
                    href="https://docs.commercetools.com/api/projects/shoppingLists#add-textlineitem">AddTextLineItem</a>
                action
                and a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-textlineitems-order">Change
                    TextLineItems Order</a>
                of the text line items <b>name-1</b> and <b>name-2</b>, because when we add text line item with <b>name-1</b>
                the order will be <b>name-2</b> and <b>name-1</b>.</p>
            <p>The <b>challenge</b> in here is, those actions cannot be added in one request because we don't know the
                text line item id of the new text line item
                with <b>name-1</b>. We need to find another way to create a new text line item with the right order.
            </p>
        </td>
    </tr>
    <tr>
        <th colspan="2">Proposed solution</th>
    </tr>
    <tr>
        <td colspan="2">
            <p>
                Normally, for a difference, we do a set intersection and then calculate action for differences,
                but that does not make sense because we are not aware of the order from the draft.
            </p>
            <p>
                Before that, we need to analyse the <a
                    href="https://docs.commercetools.com/api/projects/shoppingLists#add-textlineitem">AddTextLineItem</a>
                action, because the platform is not checking if the data exist. An API user could add the
                exact same data multiple times. So it's impossible to know the order by
                just checking the differences between the resource and draft object. Also, the name of the text line item 
                does not need to be unique as line item does. Each line item is identified by its product variant and 
                custom fields. Luckily the platform supports changing all field (except <b>addedAt</b>) of the text line 
                items, so when an order change is needed we update the
                fields of the text line items. Which will look like:
            </p>
            <pre lang="json">
{
  "version": 1,
  "actions": [
    {
      "action" : "changeTextLineItemName",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "name": {
        "de": "name1-DE",
        "en": "name1-EN"
      }
    },
    {
      "action" : "changeTextLineItemQuantity",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "quantity" : 1
    },
    {
      "action" : "setTextLineItemDescription",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "description": {
        "de": "desc1-DE",
        "en": "desc1-EN"
      }
    },
    {
      "action" : "setTextLineItemCustomField",
      "textLineItemId" : "24de3821-e27d-4ddb-bd0b-ecc99365285f",
      "name" : "textField",
      "value" : "text-1"
    },
    {
      "action" : "addTextLineItem",
      "name": {
        "de": "name2-DE",
        "en": "name2-EN"
      },
      "description": {
        "de": "desc2-DE",
        "en": "desc2-EN"
      },
      "quantity": 2,
      "addedAt": "2020-11-04T09:38:35.571Z",
      "custom": {
        "type": {
          "key": "custom-type-for-shoppinglists"
        },
        "fields": {
          "textField": "text-2"
        }
      }
    }
  ]
}
</pre>
        </td>
    </tr>
</table>

<h2 id="common">Common<a class="headerlink" href="#common" title="Permanent link">&para;</a></h2>
<h3 id="how-addedat-will-be-compared">How addedAt will be compared?<a class="headerlink" href="#how-addedat-will-be-compared" title="Permanent link">&para;</a></h3>
<p>In commercetools shopping lists API, there is no <a href="https://docs.commercetools.com/api/projects/shoppingLists#update-actions">update action</a> 
to change the <code>addedAt</code> field of the <code>LineItem</code> and <code>TextLineItem</code>, also in API it has a default value described as <code>Defaults to the current date and time.</code>, 
when it's not set in the draft, so how to compare and update this field?</p>
<p><strong>Proposed solution:</strong></p>
<p>The <code>addedAt</code> field will be synced only if the value provided in the line item draft, otherwise, the <code>addedAt</code> value will be omitted. 
To be able to sync it we need to remove and add this line item back with the up-to-date value. 
After some discussions in pull requests, we decided to not change this field.</p>
<h2 id="decision">Decision<a class="headerlink" href="#decision" title="Permanent link">&para;</a></h2>
<!-- The change that we're proposing or have agreed to implement. -->

<ul>
<li>
<p>In commercetools API, the product variant to be selected in the LineItemDraft can be specified either by its product ID plus variant ID or by its SKU. 
For the sync library, product variant will be matched by its SKU, if the SKU not set for a LineItemDraft, the draft will not be synced and an error callback will be triggered.
Check <a href="https://docs.commercetools.com/api/projects/shoppingLists#lineitemdraft-product-variant-selection">LineItemDraft Product Variant Selection</a> for more details.</p>
</li>
<li>
<p>When a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-lineitems-order">Change LineItems Order</a> action is needed, 
the line items will be removed and added back with the order provided in the <code>ShoppingListDraft</code>.</p>
</li>
<li>
<p>When a <a href="https://docs.commercetools.com/api/projects/shoppingLists#change-textlineitems-order">Change TextLineItems Order</a> action is needed, 
the text line items will be updated with using update actions with the order provided in the <code>ShoppingListDraft</code>.</p>
</li>
<li>
<p>In commercetools shopping lists API, there is no <a href="https://docs.commercetools.com/api/projects/shoppingLists#update-actions">update action</a> 
to change the <code>addedAt</code> field of the <code>LineItem</code> and <code>TextLineItem</code>, hereby we will not update the <code>addedAt</code> value.</p>
</li>
</ul>
<h2 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h2>
<!-- What becomes easier or more difficult to do and any risks introduced by the change that will need to be mitigated. -->

<ul>
<li>
<p>To ensure the order of the line items, we need to remove and add line items. That means a bigger payload and a performance overhead. </p>
</li>
<li>
<p>To ensure the order of text line items, we need to calculate and update more than expected. That means a bigger payload and a performance overhead.</p>
</li>
<li>
<p><strong>Caveat</strong>: <code>addedAt</code> values not synced.</p>
</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 commercetools
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
    
  </body>
</html>